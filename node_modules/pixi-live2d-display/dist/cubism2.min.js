!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@pixi/math"),require("@pixi/utils"),require("@pixi/core"),require("@pixi/text"),require("@pixi/display"),require("@pixi/graphics")):"function"==typeof define&&define.amd?define(["@pixi/math","@pixi/utils","@pixi/core","@pixi/text","@pixi/display","@pixi/graphics"],e):"object"==typeof exports?exports.live2d=e(require("@pixi/math"),require("@pixi/utils"),require("@pixi/core"),require("@pixi/text"),require("@pixi/display"),require("@pixi/graphics")):(t.PIXI=t.PIXI||{},t.PIXI.live2d=e(t.PIXI,t.PIXI.utils,t.PIXI,t.PIXI,t.PIXI,t.PIXI))}(window,(function(t,e,i,r,n,s){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=166)}([function(t,e,i){"use strict";i.d(e,"f",(function(){return r})),i.d(e,"b",(function(){return o})),i.d(e,"g",(function(){return a})),i.d(e,"d",(function(){return u})),i.d(e,"c",(function(){return d})),i.d(e,"a",(function(){return c})),i.d(e,"e",(function(){return l}));var r,n,s=i(1);function o(t,e,i){return t<e?e:t>i?i:t}function a(t,e){return Math.random()*(e-t)+t}function u(t,e,i,r,n){const s=e[r];null!==s&&typeof s===t&&(i[n]=s)}function d(t,e,i,r,n){const s=e[r];Array.isArray(s)&&(i[n]=s.filter(e=>null!==e&&typeof e===t))}function c(t,e){e.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{"constructor"!==i&&Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}function l(t){let e=t.lastIndexOf("/");return-1!=e&&(t=t.slice(0,e)),e=t.lastIndexOf("/"),-1!==e&&(t=t.slice(e+1)),t}(n=r||(r={})).log=function(t,...e){s.b.logLevel<=s.b.LOG_LEVEL_VERBOSE&&console.log(`[${t}]`,...e)},n.warn=function(t,...e){s.b.logLevel<=s.b.LOG_LEVEL_WARNING&&console.warn(`[${t}]`,...e)},n.error=function(t,...e){s.b.logLevel<=s.b.LOG_LEVEL_ERROR&&console.error(`[${t}]`,...e)}},function(t,e,i){"use strict";var r;i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return n})),function(t){t.LOG_LEVEL_VERBOSE=0,t.LOG_LEVEL_WARNING=1,t.LOG_LEVEL_ERROR=2,t.LOG_LEVEL_NONE=999,t.logLevel=t.LOG_LEVEL_WARNING,t.sound=!0,t.motionSync=!0,t.motionFadingDuration=500,t.idleMotionFadingDuration=2e3,t.expressionFadingDuration=500}(r||(r={}));const n="0.3.1"},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(18),n=i(19);class s{static load(t){return Object(n.a)(this.middlewares,t).then(()=>t.result)}}s.middlewares=[r.a.loader]},function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var r=i(6),n=i(4),s=i(0),o=i(19),a=i(20);var u=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};const d="Live2DFactory",c=(t,e)=>u(void 0,void 0,void 0,(function*(){if("string"==typeof t.source){const e=yield n.a.load({url:t.source,type:"json",target:t.live2dModel});e.url=t.source,t.source=e,t.live2dModel.emit("settingsJSONLoaded",e)}return e()})),l=(t,e)=>u(void 0,void 0,void 0,(function*(){if(t.source instanceof r.f)return t.settings=t.source,e();if("object"==typeof t.source){const i=m.findRuntime(t.source);if(i){const r=i.createModelSettings(t.source);return t.settings=r,t.live2dModel.emit("settingsLoaded",r),e()}}throw new TypeError("Unknown settings format.")})),h=(t,e)=>{if(t.settings){const i=m.findRuntime(t.settings);if(i)return i.ready().then(e)}return e()},f=(t,e)=>u(void 0,void 0,void 0,(function*(){yield e();const i=t.internalModel;if(i){const e=t.settings,r=m.findRuntime(e);if(r){const o=[];e.pose&&o.push(n.a.load({settings:e,url:e.pose,type:"json",target:i}).then(e=>{i.pose=r.createPose(i.coreModel,e),t.live2dModel.emit("poseLoaded",i.pose)}).catch(t=>s.f.warn(d,"Failed to load pose.\n",t))),e.physics&&o.push(n.a.load({settings:e,url:e.physics,type:"json",target:i}).then(e=>{i.physics=r.createPhysics(i.coreModel,e),t.live2dModel.emit("physicsLoaded",i.physics)}).catch(t=>s.f.warn(d,"Failed to load physics.\n",t))),o.length&&(yield Promise.all(o))}}})),p=(t,e)=>u(void 0,void 0,void 0,(function*(){if(!t.settings)throw new TypeError("Missing settings.");{const i=t.live2dModel,r=t.settings.textures.map(e=>function(t,e={}){var i;const r={resourceOptions:{crossorigin:e.crossOrigin}};if(a.Texture.fromURL)return a.Texture.fromURL(t,r).catch(t=>{if(t instanceof Error)throw t;const e=new Error("Texture loading error");throw e.event=t,e});r.resourceOptions.autoLoad=!1;const n=a.Texture.from(t,r);if(n.baseTexture.valid)return Promise.resolve(n);const s=n.baseTexture.resource;return null!==(i=s._live2d_load)&&void 0!==i||(s._live2d_load=new Promise((t,e)=>{const i=t=>{s.source.removeEventListener("error",i);const r=new Error("Texture loading error");r.event=t,e(r)};s.source.addEventListener("error",i),s.load().then(()=>t(n)).catch(i)})),s._live2d_load}(t.settings.resolveURL(e),{crossOrigin:t.options.crossOrigin}));if(yield e(),!t.internalModel)throw new TypeError("Missing internal model.");i.internalModel=t.internalModel,i.emit("modelLoaded",t.internalModel),i.textures=yield Promise.all(r),i.emit("textureLoaded",i.textures)}})),g=(t,e)=>u(void 0,void 0,void 0,(function*(){const i=t.settings;if(i instanceof r.f){const r=m.findRuntime(i);if(!r)throw new TypeError("Unknown model settings.");const s=yield n.a.load({settings:i,url:i.moc,type:"arraybuffer",target:t.live2dModel});if(!r.isValidMoc(s))throw new Error("Invalid moc data");const o=r.createCoreModel(s);return t.internalModel=r.createInternalModel(o,i,t.options),e()}throw new TypeError("Missing settings.")}));var v=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};class m{static registerRuntime(t){m.runtimes.push(t),m.runtimes.sort((t,e)=>e.version-t.version)}static findRuntime(t){for(const e of m.runtimes)if(e.test(t))return e}static setupLive2DModel(t,e,i){return v(this,void 0,void 0,(function*(){const r=new Promise(e=>t.once("textureLoaded",e)),n=new Promise(e=>t.once("modelLoaded",e)),s=Promise.all([r,n]).then(()=>t.emit("ready"));yield Object(o.a)(m.live2DModelMiddlewares,{live2dModel:t,source:e,options:i||{}}),yield s,t.emit("load")}))}static loadMotion(t,e,i){var r,o;const a=r=>t.emit("motionLoadError",e,i,r);try{const u=null===(r=t.definitions[e])||void 0===r?void 0:r[i];if(!u)return Promise.resolve(void 0);t.listeners("destroy").includes(m.releaseTasks)||t.once("destroy",m.releaseTasks);let d=m.motionTasksMap.get(t);d||(d={},m.motionTasksMap.set(t,d));let c=d[e];c||(c=[],d[e]=c);const l=t.getMotionFile(u);return null!==(o=c[i])&&void 0!==o||(c[i]=n.a.load({url:l,settings:t.settings,type:t.motionDataType,target:t}).then(r=>{var n;const s=null===(n=m.motionTasksMap.get(t))||void 0===n?void 0:n[e];s&&delete s[i];const o=t.createMotion(r,e,u);return t.emit("motionLoaded",e,i,o),o}).catch(e=>{s.f.warn(t.tag,`Failed to load motion: ${l}\n`,e),a(e)})),c[i]}catch(r){s.f.warn(t.tag,`Failed to load motion at "${e}"[${i}]\n`,r),a(r)}return Promise.resolve(void 0)}static loadExpression(t,e){var i;const r=i=>t.emit("expressionLoadError",e,i);try{const o=t.definitions[e];if(!o)return Promise.resolve(void 0);t.listeners("destroy").includes(m.releaseTasks)||t.once("destroy",m.releaseTasks);let a=m.expressionTasksMap.get(t);a||(a=[],m.expressionTasksMap.set(t,a));const u=t.getExpressionFile(o);return null!==(i=a[e])&&void 0!==i||(a[e]=n.a.load({url:u,settings:t.settings,type:"json",target:t}).then(i=>{const r=m.expressionTasksMap.get(t);r&&delete r[e];const n=t.createExpression(i,o);return t.emit("expressionLoaded",e,n),n}).catch(e=>{s.f.warn(t.tag,`Failed to load expression: ${u}\n`,e),r(e)})),a[e]}catch(i){s.f.warn(t.tag,`Failed to load expression at [${e}]\n`,i),r(i)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof r.g?m.motionTasksMap.delete(this):m.expressionTasksMap.delete(this)}}m.runtimes=[],m.urlToJSON=c,m.jsonToSettings=l,m.waitUntilReady=h,m.setupOptionals=f,m.setupEssentials=p,m.createInternalModel=g,m.live2DModelMiddlewares=[c,l,h,f,p,g],m.motionTasksMap=new WeakMap,m.expressionTasksMap=new WeakMap,r.g.prototype._loadMotion=function(t,e){return m.loadMotion(this,t,e)},r.a.prototype._loadExpression=function(t){return m.loadExpression(this,t)}},function(t,e,i){"use strict";var r=i(8);i.d(e,"d",(function(){return r.a})),i.d(e,"e",(function(){return r.b}));var n=i(13);i.d(e,"a",(function(){return n.a}));var s=i(17);i.d(e,"b",(function(){return s.a}));var o=i(14);i.d(e,"f",(function(){return o.a}));var a=i(10);i.d(e,"i",(function(){return a.a})),i.d(e,"j",(function(){return a.b}));var u=i(15);i.d(e,"g",(function(){return u.a})),i.d(e,"h",(function(){return u.b}));var d=i(7);i.d(e,"k",(function(){return d.a}));var c=i(16);i.d(e,"c",(function(){return c.a}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var r=i(0),n=i(33),s=i.n(n);class o{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach(t=>t.volume=this._volume)}static add(t,e,i){const n=new Audio(t);return n.volume=this._volume,n.preload="auto",n.addEventListener("ended",()=>{this.dispose(n),null==e||e()}),n.addEventListener("error",e=>{this.dispose(n),r.f.warn("SoundManager",`Error occurred on "${t}"`,e.error),null==i||i(e.error)}),this.audios.push(n),n}static play(t){return new Promise((e,i)=>{var r;null===(r=t.play())||void 0===r||r.catch(e=>{t.dispatchEvent(new ErrorEvent("error",{error:e})),i(e)}),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)})}static dispose(t){t.pause(),t.removeAttribute("src"),s()(this.audios,t)}static destroy(){for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}o.audios=[],o._volume=.5},function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return n}));const r=2,n=2},function(t,e,i){var r=i(38),n="object"==typeof self&&self&&self.Object===Object&&self,s=r||n||Function("return this")();t.exports=s},function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return s}));var r,n=i(0);!function(t){t[t.NONE=0]="NONE",t[t.IDLE=1]="IDLE",t[t.NORMAL=2]="NORMAL",t[t.FORCE=3]="FORCE"}(r||(r={}));class s{constructor(){this.debug=!1,this.currentPriority=r.NONE,this.reservePriority=r.NONE}reserve(t,e,i){if(i<=r.NONE)return n.f.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return n.f.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return n.f.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(i===r.IDLE){if(this.currentPriority!==r.NONE)return n.f.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(void 0!==this.reservedIdleGroup)return n.f.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(i<r.FORCE){if(i<=this.currentPriority)return n.f.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(i<=this.reservePriority)return n.f.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,i)}return!0}start(t,e,i,s){if(s===r.IDLE){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==r.NONE)return n.f.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,i)),!1}else{if(e!==this.reservedGroup||i!==this.reservedIndex)return n.f.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,i)),!1;this.setReserved(void 0,void 0,r.NONE)}return!!t&&(this.setCurrent(e,i,s),!0)}complete(){this.setCurrent(void 0,void 0,r.NONE)}setCurrent(t,e,i){this.currentPriority=i,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,i){this.reservePriority=i,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,r.NONE),this.setReserved(void 0,void 0,r.NONE),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return void 0===this.currentGroup&&void 0===this.reservedIdleGroup}shouldOverrideExpression(){return this.currentPriority>r.IDLE}dump(t,e){if(this.debug){return`\n<Requested> group = "${t}", index = ${e}\n`+["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"].map(t=>"["+t+"] "+this[t]).join("\n")}return""}}},function(t,e,i){var r=i(54),n=i(60);t.exports=function(t,e){var i=n(t,e);return r(i)?i:void 0}},,function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var r=i(0),n=i(3),s=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};class o extends n.EventEmitter{constructor(t,e){super(),this.expressions=[],this.reserveExpressionIndex=-1,this.destroyed=!1,this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return s(this,void 0,void 0,(function*(){if(!this.definitions[t])return void r.f.warn(this.tag,`Undefined expression at [${t}]`);if(null===this.expressions[t])return void r.f.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e}))}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return s(this,void 0,void 0,(function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)null!==this.expressions[e]&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1}))}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return s(this,void 0,void 0,(function*(){if("number"!=typeof t&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length))return!1;if(t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!(!e||this.reserveExpressionIndex!==t)&&(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)}))}update(t,e){return!this.isFinished()&&this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy");this.definitions=void 0,this.expressions=void 0}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(0),n=i(3);class s{constructor(t){this.json=t;let e=t.url;if("string"!=typeof e)throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=Object(r.e)(this.url)}resolveURL(t){return n.url.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),void 0!==this.pose&&(this.pose=t(this.pose,"pose")),void 0!==this.physics&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles(e=>(t.push(e),e)),t}validateFiles(t){const e=(e,i)=>{const r=this.resolveURL(e);if(!t.includes(r)){if(i)throw new Error(`File "${e}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(t=>e(t,!0)),this.getDefinedFiles().filter(t=>e(t,!1))}}},function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return c}));var r,n=i(1),s=i(10),o=i(7),a=i(0),u=i(3),d=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};!function(t){t.ALL="ALL",t.IDLE="IDLE",t.NONE="NONE"}(r||(r={}));class c extends u.EventEmitter{constructor(t,e){super(),this.motionGroups={},this.state=new s.b,this.playing=!1,this.destroyed=!1,this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){(null==t?void 0:t.idleMotionGroup)&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const t of Object.keys(this.definitions))this.motionGroups[t]=[];let e;switch(null==t?void 0:t.motionPreload){case r.NONE:return;case r.ALL:e=Object.keys(this.definitions);break;case r.IDLE:default:e=[this.groups.idle]}for(const t of e)if(this.definitions[t])for(let e=0;e<this.definitions[t].length;e++)this.loadMotion(t,e).then()}loadMotion(t,e){var i;return d(this,void 0,void 0,(function*(){if(!(null===(i=this.definitions[t])||void 0===i?void 0:i[e]))return void a.f.warn(this.tag,`Undefined motion at "${t}"[${e}]`);if(null===this.motionGroups[t][e])return void a.f.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);if(this.motionGroups[t][e])return this.motionGroups[t][e];const r=yield this._loadMotion(t,e);return this.destroyed?void 0:(this.motionGroups[t][e]=null!=r?r:null,r)}))}_loadMotion(t,e){throw new Error("Not implemented.")}startMotion(t,e,i=s.a.NORMAL){var r;return d(this,void 0,void 0,(function*(){if(!this.state.reserve(t,e,i))return!1;const s=null===(r=this.definitions[t])||void 0===r?void 0:r[e];if(!s)return!1;let u;if(this.currentAudio&&o.a.dispose(this.currentAudio),n.b.sound){const t=this.getSoundFile(s);if(t)try{u=o.a.add(this.settings.resolveURL(t),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=u}catch(e){a.f.warn(this.tag,"Failed to create audio",t,e)}}const d=yield this.loadMotion(t,e);if(u){const t=o.a.play(u).catch(t=>a.f.warn(this.tag,"Failed to play audio",u.src,t));n.b.motionSync&&(yield t)}return this.state.start(d,t,e,i)?(a.f.log(this.tag,"Start motion:",this.getMotionName(s)),this.emit("motionStart",t,e,u),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(d),!0):(u&&(o.a.dispose(u),this.currentAudio=void 0),!1)}))}startRandomMotion(t,e){return d(this,void 0,void 0,(function*(){const i=this.definitions[t];if(null==i?void 0:i.length){const r=[];for(let e=0;e<i.length;e++)null===this.motionGroups[t][e]||this.state.isActive(t,e)||r.push(e);if(r.length){const i=Math.floor(Math.random()*r.length);return this.startMotion(t,r[i],e)}}return!1}))}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(o.a.dispose(this.currentAudio),this.currentAudio=void 0)}update(t,e){var i,r;this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&(null===(i=this.expressionManager)||void 0===i||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,s.a.IDLE));let n=this.updateParameters(t,e);return n=(null===(r=this.expressionManager)||void 0===r?void 0:r.update(t,e))||n,n}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),null===(t=this.expressionManager)||void 0===t||t.destroy();this.definitions=void 0,this.motionGroups=void 0}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var r=i(8),n=i(17),s=i(2),o=i(3);const a={x:0,y:0,width:0,height:0};class u extends o.EventEmitter{constructor(){super(...arguments),this.focusController=new n.a,this.originalWidth=0,this.originalHeight=0,this.width=0,this.height=0,this.localTransform=new s.Matrix,this.drawingMatrix=new s.Matrix,this.hitAreas={},this.textureFlipY=!1,this.viewport=[0,0,0,0],this.destroyed=!1}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this.getSize();this.originalWidth=t[0],this.originalHeight=t[1];const e=Object.assign({width:r.b,height:r.a},this.getLayout());this.localTransform.scale(e.width/r.b,e.height/r.a),this.width=this.originalWidth*this.localTransform.a,this.height=this.originalHeight*this.localTransform.d;const i=void 0!==e.x&&e.x-e.width/2||void 0!==e.centerX&&e.centerX||void 0!==e.left&&e.left-e.width/2||void 0!==e.right&&e.right+e.width/2||0,n=void 0!==e.y&&e.y-e.height/2||void 0!==e.centerY&&e.centerY||void 0!==e.top&&e.top-e.height/2||void 0!==e.bottom&&e.bottom+e.height/2||0;this.localTransform.translate(this.width*i,-this.height*n)}setupHitAreas(){const t=this.getHitAreaDefs().filter(t=>t.index>=0);for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,t,e))}isHit(t,e,i){if(!this.hitAreas[t])return!1;const r=this.hitAreas[t].index,n=this.getDrawableBounds(r,a);return n.x<=e&&e<=n.x+n.width&&n.y<=i&&i<=n.y+n.height}getDrawableBounds(t,e){const i=this.getDrawableVertices(t);let r=i[0],n=i[0],s=i[1],o=i[1];for(let t=0;t<i.length;t+=2){const e=i[t],a=i[t+1];r=Math.min(e,r),n=Math.max(e,n),s=Math.min(a,s),o=Math.max(a,o)}return null!=e||(e={}),e.x=r,e.y=s,e.width=n-r,e.height=o-s,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var r=i(0);class n{constructor(){this.targetX=0,this.targetY=0,this.x=0,this.y=0,this.vx=0,this.vy=0}focus(t,e,i=!1){this.targetX=Object(r.b)(t,-1,1),this.targetY=Object(r.b)(e,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(e)<.01&&Math.abs(i)<.01)return;const r=Math.sqrt(Math.pow(e,2)+Math.pow(i,2)),n=40/7.5/(1e3/t);let s=n*(e/r)-this.vx,o=n*(i/r)-this.vy;const a=Math.sqrt(Math.pow(s,2)+Math.pow(o,2)),u=n*(1/150)*t;a>u&&(s*=u/a,o*=u/a),this.vx+=s,this.vy+=o;const d=Math.sqrt(Math.pow(this.vx,2)+Math.pow(this.vy,2)),c=.5*(Math.sqrt(Math.pow(u,2)+8*u*r)-u);d>c&&(this.vx*=c/d,this.vy*=c/d),this.x+=this.vx,this.y+=this.vy}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(0);class n extends Error{constructor(t,e,i,r=!1){super(t),this.url=e,this.status=i,this.aborted=r}}class s{static createXHR(t,e,i,o,a){const u=new XMLHttpRequest;if(s.allXhrSet.add(u),t){let e=s.xhrMap.get(t);e?e.add(u):(e=new Set([u]),s.xhrMap.set(t,e)),t.listeners("destroy").includes(s.cancelXHRs)||t.once("destroy",s.cancelXHRs)}return u.open("GET",e),u.responseType=i,u.onload=()=>{200!==u.status&&0!==u.status||!u.response?u.onerror():o(u.response)},u.onerror=()=>{r.f.warn("XHRLoader",`Failed to load resource as ${u.responseType} (Status ${u.status}): ${e}`),a(new n("Network error.",e,u.status))},u.onabort=()=>a(new n("Aborted.",e,u.status,!0)),u.onloadend=()=>{var e;s.allXhrSet.delete(u),t&&(null===(e=s.xhrMap.get(t))||void 0===e||e.delete(u))},u}static cancelXHRs(){var t;null===(t=s.xhrMap.get(this))||void 0===t||t.forEach(t=>{t.abort(),s.allXhrSet.delete(t)}),s.xhrMap.delete(this)}static release(){s.allXhrSet.forEach(t=>t.abort()),s.allXhrSet.clear(),s.xhrMap=new WeakMap}}s.xhrMap=new WeakMap,s.allXhrSet=new Set,s.loader=(t,e)=>new Promise((e,i)=>{s.createXHR(t.target,t.settings?t.settings.resolveURL(t.url):t.url,t.type,i=>{t.result=i,e()},i).send()})},function(t,e,i){"use strict";function r(t,e){let i=-1;return function r(n,s){if(s)return Promise.reject(s);if(n<=i)return Promise.reject(new Error("next() called multiple times"));i=n;const o=t[n];if(!o)return Promise.resolve();try{return Promise.resolve(o(e,r.bind(null,n+1)))}catch(s){return Promise.reject(s)}}(0)}i.d(e,"a",(function(){return r}))},function(t,e){t.exports=i},function(t,e,i){var r=i(22),n=i(56),s=i(57),o=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?n(t):s(t)}},function(t,e,i){var r=i(9).Symbol;t.exports=r},,function(t,e){t.exports=r},function(t,e){t.exports=function(t){return t}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},,,,,,function(t,e,i){"use strict";i.d(e,"h",(function(){return r.e})),i.d(e,"g",(function(){return r.d})),i.d(e,"a",(function(){return r.a})),i.d(e,"c",(function(){return r.b})),i.d(e,"m",(function(){return r.f})),i.d(e,"p",(function(){return r.i})),i.d(e,"q",(function(){return r.j})),i.d(e,"o",(function(){return r.h})),i.d(e,"n",(function(){return r.g})),i.d(e,"r",(function(){return r.k})),i.d(e,"f",(function(){return r.c})),i.d(e,"k",(function(){return v})),i.d(e,"l",(function(){return c})),i.d(e,"e",(function(){return a})),i.d(e,"x",(function(){return m.b})),i.d(e,"s",(function(){return m.a})),i.d(e,"i",(function(){return n.a})),i.d(e,"j",(function(){return x.a})),i.d(e,"t",(function(){return y.a})),i.d(e,"b",(function(){return w})),i.d(e,"u",(function(){return E})),i.d(e,"B",(function(){return h.f})),i.d(e,"w",(function(){return h.b})),i.d(e,"C",(function(){return h.g})),i.d(e,"z",(function(){return h.d})),i.d(e,"y",(function(){return h.c})),i.d(e,"v",(function(){return h.a})),i.d(e,"A",(function(){return h.e})),i.d(e,"d",(function(){return _}));var r=i(6),n=i(5),s=i(34),o=i(2);class a{constructor(){this._autoInteract=!1}get autoInteract(){return this._autoInteract}set autoInteract(t){t!==this._autoInteract&&(t?this.on("pointertap",u,this):this.off("pointertap",u,this),this._autoInteract=t)}registerInteraction(t){t!==this.interactionManager&&(this.unregisterInteraction(),this._autoInteract&&t&&(this.interactionManager=t,t.on("pointermove",d,this)))}unregisterInteraction(){var t;this.interactionManager&&(null===(t=this.interactionManager)||void 0===t||t.off("pointermove",d,this),this.interactionManager=void 0)}}function u(t){this.tap(t.data.global.x,t.data.global.y)}function d(t){this.focus(t.data.global.x,t.data.global.y)}class c extends o.Transform{}var l,h=i(0);const f=new o.Point,p=new o.Matrix;let g=null===(l=window.PIXI)||void 0===l?void 0:l.Ticker;class v extends s.Container{constructor(t){super(),this.tag="Live2DModel(uninitialized)",this.textures=[],this.transform=new c,this.anchor=new o.ObservablePoint(this.onAnchorChange,this,0,0),this.glContextID=-1,this.elapsedTime=performance.now(),this.deltaTime=0,this._autoUpdate=!1,this.once("modelLoaded",()=>this.init(t))}static from(t,e){const i=new this(e);return n.a.setupLive2DModel(i,t,e).then(()=>i)}static fromSync(t,e){const i=new this(e);return n.a.setupLive2DModel(i,t,e).then(null==e?void 0:e.onLoad).catch(null==e?void 0:e.onError),i}static registerTicker(t){g=t}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t?this._destroyed||(g?(g.shared.add(this.onTickerUpdate,this),this._autoUpdate=!0):h.f.warn(this.tag,"No Ticker registered, please call Live2DModel.registerTicker(Ticker).")):(null==g||g.shared.remove(this.onTickerUpdate,this),this._autoUpdate=!1)}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`;const e=Object.assign({autoUpdate:!0,autoInteract:!0},t);e.autoInteract&&(this.interactive=!0),this.autoInteract=e.autoInteract,this.autoUpdate=e.autoUpdate}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,i){return void 0===e?this.internalModel.motionManager.startRandomMotion(t,i):this.internalModel.motionManager.startMotion(t,e,i)}expression(t){return this.internalModel.motionManager.expressionManager?void 0===t?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,i=!1){f.x=t,f.y=e,this.toModelPosition(f,f,!0),this.internalModel.focusController.focus(f.x/this.internalModel.originalWidth*2-1,-(f.y/this.internalModel.originalHeight*2-1),i)}tap(t,e){const i=this.hitTest(t,e);i.length&&(h.f.log(this.tag,"Hit",i),this.emit("hit",i))}hitTest(t,e){return f.x=t,f.y=e,this.toModelPosition(f,f),this.internalModel.hitTest(f.x,f.y)}toModelPosition(t,e=t.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}onTickerUpdate(){this.update(g.shared.deltaMS)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){this.registerInteraction(t.plugins.interaction),t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let i=0;i<this.textures.length;i++){const r=this.textures[i];r.valid&&(!e&&r.baseTexture._glTextures[this.glContextID]||(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(r.baseTexture,0)),this.internalModel.bindTexture(i,r.baseTexture._glTextures[this.glContextID].texture),r.baseTexture.touched=t.textureGC.count)}const i=t.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const r=p.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(r),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),this.autoUpdate=!1,this.unregisterInteraction(),(null==t?void 0:t.texture)&&this.textures.forEach(e=>e.destroy(t.baseTexture)),this.internalModel.destroy(),super.destroy(t)}}Object(h.a)(v,[a]);var m=i(1),x=i(4),y=i(18),M=i(3),b=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};class w{static resolveURL(t,e){var i;const r=null===(i=w.filesMap[t])||void 0===i?void 0:i[e];if(void 0===r)throw new Error("Cannot find this file from uploaded files: "+e);return r}static upload(t,e){return b(this,void 0,void 0,(function*(){const i={};for(const r of e.getDefinedFiles()){const n=decodeURI(M.url.resolve(e.url,r)),s=t.find(t=>t.webkitRelativePath===n);s&&(i[r]=URL.createObjectURL(s))}w.filesMap[e._objectURL]=i}))}static createSettings(t){return b(this,void 0,void 0,(function*(){const e=t.find(t=>t.name.endsWith("model.json")||t.name.endsWith("model3.json"));if(!e)throw new TypeError("Settings file not found");const i=yield w.readText(e),r=JSON.parse(i);r.url=e.webkitRelativePath;const s=n.a.findRuntime(r);if(!s)throw new Error("Unknown settings JSON");const o=s.createModelSettings(r);return o._objectURL=URL.createObjectURL(e),o}))}static readText(t){return b(this,void 0,void 0,(function*(){return new Promise((e,i)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=i,r.readAsText(t,"utf8")})}))}}w.filesMap={},w.factory=(t,e)=>b(void 0,void 0,void 0,(function*(){if(Array.isArray(t.source)&&t.source[0]instanceof File){const e=t.source;let i=e.settings;if(i){if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings')}else i=yield w.createSettings(e);i.validateFiles(e.map(t=>encodeURI(t.webkitRelativePath))),yield w.upload(e,i),i.resolveURL=function(t){return w.resolveURL(this._objectURL,t)},t.source=i,t.live2dModel.once("modelLoaded",t=>{t.once("destroy",(function(){const t=this.settings._objectURL;if(URL.revokeObjectURL(t),w.filesMap[t])for(const e of Object.values(w.filesMap[t]))URL.revokeObjectURL(e);delete w.filesMap[t]}))})}return e()})),n.a.live2DModelMiddlewares.unshift(w.factory);var P=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};class E{static unzip(t,e){return P(this,void 0,void 0,(function*(){const i=yield E.getFilePaths(t),r=[];for(const t of e.getDefinedFiles()){const n=decodeURI(M.url.resolve(e.url,t));i.includes(n)&&r.push(n)}const n=yield E.getFiles(t,r);for(let t=0;t<n.length;t++){const e=r[t],i=n[t];Object.defineProperty(i,"webkitRelativePath",{value:e})}return n}))}static createSettings(t){return P(this,void 0,void 0,(function*(){const e=(yield E.getFilePaths(t)).find(t=>t.endsWith("model.json")||t.endsWith("model3.json"));if(!e)throw new Error("Settings file not found");const i=yield E.readText(t,e);if(!i)throw new Error("Empty settings file: "+e);const r=JSON.parse(i);r.url=e;const s=n.a.findRuntime(r);if(!s)throw new Error("Unknown settings JSON");return s.createModelSettings(r)}))}static zipReader(t,e){return P(this,void 0,void 0,(function*(){throw new Error("Not implemented")}))}static getFilePaths(t){return P(this,void 0,void 0,(function*(){throw new Error("Not implemented")}))}static getFiles(t,e){return P(this,void 0,void 0,(function*(){throw new Error("Not implemented")}))}static readText(t,e){return P(this,void 0,void 0,(function*(){throw new Error("Not implemented")}))}static releaseReader(t){}}E.ZIP_PROTOCOL="zip://",E.uid=0,E.factory=(t,e)=>P(void 0,void 0,void 0,(function*(){const i=t.source;let r,n,s;if("string"==typeof i&&(i.endsWith(".zip")||i.startsWith(E.ZIP_PROTOCOL))?(r=i.startsWith(E.ZIP_PROTOCOL)?i.slice(E.ZIP_PROTOCOL.length):i,n=yield x.a.load({url:r,type:"blob",target:t.live2dModel})):Array.isArray(i)&&1===i.length&&i[0]instanceof File&&i[0].name.endsWith(".zip")&&(n=i[0],r=URL.createObjectURL(n),s=i.settings),n){if(!n.size)throw new Error("Empty zip file");const e=yield E.zipReader(n,r);s||(s=yield E.createSettings(e)),s._objectURL=E.ZIP_PROTOCOL+E.uid+"/"+s.url;const i=yield E.unzip(e,s);i.settings=s,t.source=i,r.startsWith("blob:")&&t.live2dModel.once("modelLoaded",t=>{t.once("destroy",(function(){URL.revokeObjectURL(r)}))}),E.releaseReader(e)}return e()})),n.a.live2DModelMiddlewares.unshift(E.factory);var I=i(35),O=i(24);const L=new o.Rectangle;class _ extends I.Graphics{constructor(){super(),this.initialized=!1,this.texts=[],this.strokeWidth=4,this.normalColor=14883354,this.activeColor=2017330,this.interactive=!0,this.on("added",this.init).on("pointermove",this.onPointerMove)}init(){const t=this.parent.internalModel,e=new O.TextStyle({fontSize:24,fill:"#ffffff",stroke:"#000000",strokeThickness:4});this.texts=Object.keys(t.hitAreas).map(t=>{const i=new O.Text(t,e);return i.visible=!1,this.addChild(i),i})}onPointerMove(t){const e=this.parent.hitTest(t.data.global.x,t.data.global.y);this.texts.forEach(t=>{t.visible=e.includes(t.text)})}_render(t){const e=this.parent.internalModel,i=1/Math.sqrt(Math.pow(this.transform.worldTransform.a,2)+Math.pow(this.transform.worldTransform.b,2));this.texts.forEach(t=>{this.lineStyle({width:this.strokeWidth*i,color:t.visible?this.activeColor:this.normalColor});const r=e.getDrawableBounds(e.hitAreas[t.text].index,L),n=e.localTransform;r.x=r.x*n.a+n.tx,r.y=r.y*n.d+n.ty,r.width=r.width*n.a,r.height=r.height*n.d,this.drawRect(r.x,r.y,r.width,r.height),t.x=r.x+this.strokeWidth*i,t.y=r.y+this.strokeWidth*i,t.scale.set(i)}),super._render(t),this.clear()}}},function(t,e,i){var r=i(48)(i(62));t.exports=r},function(t,e){t.exports=n},function(t,e){t.exports=s},function(t,e,i){var r=i(11),n=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=n},function(t,e,i){var r=i(21),n=i(26);t.exports=function(t){if(!n(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(55))},function(t,e){var i=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e){t.exports=function(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},,,,,,,function(t,e,i){var r=i(25),n=i(49),s=i(51);t.exports=function(t,e){return s(n(t,e,r),t+"")}},function(t,e,i){var r=i(50),n=Math.max;t.exports=function(t,e,i){return e=n(void 0===e?t.length-1:e,0),function(){for(var s=arguments,o=-1,a=n(s.length-e,0),u=Array(a);++o<a;)u[o]=s[e+o];o=-1;for(var d=Array(e+1);++o<e;)d[o]=s[o];return d[e]=i(u),r(t,this,d)}}},function(t,e){t.exports=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}},function(t,e,i){var r=i(52),n=i(61)(r);t.exports=n},function(t,e,i){var r=i(53),n=i(36),s=i(25),o=n?function(t,e){return n(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:s;t.exports=o},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e,i){var r=i(37),n=i(58),s=i(26),o=i(39),a=/^\[object .+?Constructor\]$/,u=Function.prototype,d=Object.prototype,c=u.toString,l=d.hasOwnProperty,h=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!s(t)||n(t))&&(r(t)?h:a).test(o(t))}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var r=i(22),n=Object.prototype,s=n.hasOwnProperty,o=n.toString,a=r?r.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),i=t[a];try{t[a]=void 0;var r=!0}catch(t){}var n=o.call(t);return r&&(e?t[a]=i:delete t[a]),n}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){var r,n=i(59),s=(r=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!s&&s in t}},function(t,e,i){var r=i(9)["__core-js_shared__"];t.exports=r},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e){var i=Date.now;t.exports=function(t){var e=0,r=0;return function(){var n=i(),s=16-(n-r);if(r=n,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,i){var r=i(63);t.exports=function(t,e){return t&&t.length&&e&&e.length?r(t,e):t}},function(t,e,i){var r=i(40),n=i(64),s=i(68),o=i(41),a=i(69),u=Array.prototype.splice;t.exports=function(t,e,i,d){var c=d?s:n,l=-1,h=e.length,f=t;for(t===e&&(e=a(e)),i&&(f=r(t,o(i)));++l<h;)for(var p=0,g=e[l],v=i?i(g):g;(p=c(f,v,p,d))>-1;)f!==t&&u.call(f,p,1),u.call(t,p,1);return t}},function(t,e,i){var r=i(65),n=i(66),s=i(67);t.exports=function(t,e,i){return e==e?s(t,e,i):r(t,n,i)}},function(t,e){t.exports=function(t,e,i,r){for(var n=t.length,s=i+(r?1:-1);r?s--:++s<n;)if(e(t[s],s,t))return s;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,i){for(var r=i-1,n=t.length;++r<n;)if(t[r]===e)return r;return-1}},function(t,e){t.exports=function(t,e,i,r){for(var n=i-1,s=t.length;++n<s;)if(r(t[n],e))return n;return-1}},function(t,e){t.exports=function(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}},function(t,e,i){"use strict";const r=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(t,e){r.call(this,t,e),e.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)}},,,,,,,,,,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return p})),i.d(e,"c",(function(){return v})),i.d(e,"d",(function(){return d})),i.d(e,"e",(function(){return s})),i.d(e,"f",(function(){return h})),i.d(e,"g",(function(){return y})),i.d(e,"h",(function(){return b}));i(87),i(70);var r=i(13),n=i(1);class s extends AMotion{constructor(t){super(),this.params=[],this.setFadeIn(t.fade_in>0?t.fade_in:n.b.expressionFadingDuration),this.setFadeOut(t.fade_out>0?t.fade_out:n.b.expressionFadingDuration),Array.isArray(t.params)&&t.params.forEach(t=>{const e=t.calc||"add";if("add"===e){const e=t.def||0;t.val-=e}else if("mult"===e){const e=t.def||1;t.val/=e}this.params.push({calc:e,val:t.val,id:t.id})})}updateParamExe(t,e,i,r){this.params.forEach(e=>{t.setParamFloat(e.id,e.val*i)})}}class o extends r.a{constructor(t,e){var i;super(t,e),this.queueManager=new MotionQueueManager,this.definitions=null!==(i=this.settings.expressions)&&void 0!==i?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.name===t)}getExpressionFile(t){return t.file}createExpression(t,e){return new s(t)}_setExpression(t){return this.queueManager.startMotion(t)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}}var a=i(16),u=i(15);class d extends u.a{constructor(t,e){super(t,e),this.groups={idle:"idle"},this.motionDataType="arraybuffer",this.queueManager=new MotionQueueManager,this.definitions=this.settings.motions,this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new o(this.settings,t))}isFinished(){return this.queueManager.isFinished()}createMotion(t,e,i){const r=Live2DMotion.loadMotion(t),s=e===this.groups.idle?n.b.idleMotionFadingDuration:n.b.motionFadingDuration;return r.setFadeIn(i.fade_in>0?i.fade_in:s),r.setFadeOut(i.fade_out>0?i.fade_out:s),r}getMotionFile(t){return t.file}getMotionName(t){return t.file}getSoundFile(t){return t.sound}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}var c,l=i(0);!function(t){t[t.Idle=0]="Idle",t[t.Closing=1]="Closing",t[t.Closed=2]="Closed",t[t.Opening=3]="Opening"}(c||(c={}));class h{constructor(t){this.coreModel=t,this.blinkInterval=4e3,this.closingDuration=100,this.closedDuration=50,this.openingDuration=150,this.eyeState=c.Idle,this.eyeParamValue=1,this.closedTimer=0,this.nextBlinkTimeLeft=this.blinkInterval,this.leftParam=t.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=t.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(t){this.eyeParamValue=Object(l.b)(t,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(t){switch(this.eyeState){case c.Idle:this.nextBlinkTimeLeft-=t,this.nextBlinkTimeLeft<0&&(this.eyeState=c.Closing,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+Object(l.g)(0,2e3));break;case c.Closing:this.setEyeParams(this.eyeParamValue+t/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=c.Closed,this.closedTimer=0);break;case c.Closed:this.closedTimer+=t,this.closedTimer>=this.closedDuration&&(this.eyeState=c.Opening);break;case c.Opening:this.setEyeParams(this.eyeParamValue+t/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=c.Idle)}}}const f=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class p extends a.a{constructor(t,e,i){super(),this.textureFlipY=!0,this.drawDataCount=0,this.disableCulling=!1,this.coreModel=t,this.settings=e,this.motionManager=new d(e,i),this.eyeBlink=new h(t),this.eyeballXParamIndex=t.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=t.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=t.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=t.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=t.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=t.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=t.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:t,value:e})=>this.coreModel.setParamFloat(t,e)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:t,value:e})=>this.coreModel.setPartsOpacity(t,e)),this.coreModel.saveParam();const t=this.coreModel.getModelContext()._$aS;(null==t?void 0:t.length)&&(this.drawDataCount=t.length);let e=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:t=>e=t,get:()=>!this.disableCulling&&e});const i=this.coreModel.getModelContext().clipManager,r=i.setupClip;i.setupClip=(t,e)=>{r.call(i,t,e),e.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const t=this.settings.layout||{};return Object.assign(Object.assign({},t),{centerX:t.center_x,centerY:t.center_y})}updateWebGLContext(t,e){const i=this.coreModel.drawParamWebGL;i.firstDraw=!0,i.setGL(t),i.glno=e;for(const t in i)i.hasOwnProperty(t)&&i[t]instanceof WebGLBuffer&&(i[t]=null);const r=this.coreModel.getModelContext().clipManager;r.curFrameNo=e;const n=t.getParameter(t.FRAMEBUFFER_BINDING);r.getMaskRenderTexture(),t.bindFramebuffer(t.FRAMEBUFFER,n)}bindTexture(t,e){this.coreModel.setTexture(t,e)}getHitAreaDefs(){var t;return(null===(t=this.settings.hitAreas)||void 0===t?void 0:t.map(t=>({id:t.id,name:t.name,index:this.coreModel.getDrawDataIndex(t.id)})))||[]}getDrawableIDs(){const t=this.coreModel.getModelContext(),e=[];for(let i=0;i<this.drawDataCount;i++){const r=t.getDrawData(i);r&&e.push(r.getDrawDataID().id)}return e}getDrawableIndex(t){return this.coreModel.getDrawDataIndex(t)}getDrawableVertices(t){if("string"==typeof t&&-1===(t=this.coreModel.getDrawDataIndex(t)))throw new TypeError("Unable to find drawable ID: "+t);return this.coreModel.getTransformedPoints(t).slice()}update(t,e){var i,r,n;super.update(t,e);const s=this.coreModel;this.emit("beforeMotionUpdate");const o=this.motionManager.update(this.coreModel,e);this.emit("afterMotionUpdate"),s.saveParam(),o||null===(i=this.eyeBlink)||void 0===i||i.update(t),this.updateFocus(),this.updateNaturalMovements(t,e),null===(r=this.physics)||void 0===r||r.update(e),null===(n=this.pose)||void 0===n||n.update(t),this.emit("beforeModelUpdate"),s.update(),s.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,30*this.focusController.x),this.coreModel.addToParamFloat(this.angleYParamIndex,30*this.focusController.y),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,10*this.focusController.x)}updateNaturalMovements(t,e){const i=e/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(i/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(i/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(i/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(i/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(i/3.2345))}draw(t){const e=this.disableCulling;t.getParameter(t.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const i=this.drawingMatrix;f[0]=i.a,f[1]=i.b,f[4]=i.c,f[5]=i.d,f[12]=i.tx,f[13]=i.ty,this.coreModel.setMatrix(f),this.coreModel.draw(),this.disableCulling=e}destroy(){super.destroy(),this.coreModel=void 0}}var g=i(14);class v extends g.a{constructor(t){if(super(t),this.motions={},!v.isValidJSON(t))throw new TypeError("Invalid JSON.");this.moc=t.model,Object(l.c)("string",t,this,"textures","textures"),this.copy(t)}static isValidJSON(t){var e;return!!t&&"string"==typeof t.model&&(null===(e=t.textures)||void 0===e?void 0:e.length)>0&&t.textures.every(t=>"string"==typeof t)}copy(t){Object(l.d)("string",t,this,"name","name"),Object(l.d)("string",t,this,"pose","pose"),Object(l.d)("string",t,this,"physics","physics"),Object(l.d)("object",t,this,"layout","layout"),Object(l.d)("object",t,this,"motions","motions"),Object(l.c)("object",t,this,"hit_areas","hitAreas"),Object(l.c)("object",t,this,"expressions","expressions"),Object(l.c)("object",t,this,"init_params","initParams"),Object(l.c)("object",t,this,"init_opacities","initOpacities")}replaceFiles(t){super.replaceFiles(t);for(const[e,i]of Object.entries(this.motions))for(let r=0;r<i.length;r++)i[r].file=t(i[r].file,`motions.${e}[${r}].file`),void 0!==i[r].sound&&(i[r].sound=t(i[r].sound,`motions.${e}[${r}].sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].file=t(this.expressions[e].file,`expressions[${e}].file`)}}const m={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},x={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class y{constructor(t,e){this.coreModel=t,this.physicsHairs=[],e.physics_hair&&(this.physicsHairs=e.physics_hair.map(t=>{const e=new PhysicsHair;return e.setup(t.setup.length,t.setup.regist,t.setup.mass),t.src.forEach(({id:t,ptype:i,scale:r,weight:n})=>{const s=m[i];s&&e.addSrcParam(s,t,r,n)}),t.targets.forEach(({id:t,ptype:i,scale:r,weight:n})=>{const s=x[i];s&&e.addTargetParam(s,t,r,n)}),e}))}update(t){this.physicsHairs.forEach(e=>e.update(this.coreModel,t))}}class M{constructor(t){this.id=t,this.paramIndex=-1,this.partsIndex=-1,this.link=[]}initIndex(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)}}class b{constructor(t,e){this.coreModel=t,this.opacityAnimDuration=500,this.partsGroups=[],e.parts_visible&&(this.partsGroups=e.parts_visible.map(({group:t})=>t.map(({id:t,link:e})=>{const i=new M(t);return e&&(i.link=e.map(t=>new M(t))),i})),this.init())}init(){this.partsGroups.forEach(t=>{t.forEach(t=>{if(t.initIndex(this.coreModel),t.paramIndex>=0){const e=0!==this.coreModel.getParamFloat(t.paramIndex);this.coreModel.setPartsOpacity(t.partsIndex,e?1:0),this.coreModel.setParamFloat(t.paramIndex,e?1:0),t.link.length>0&&t.link.forEach(t=>t.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(t,e){const i=this.coreModel;let r=1,n=t.findIndex(({paramIndex:t,partsIndex:e})=>e>=0&&0!==i.getParamFloat(t));if(n>=0){const s=i.getPartsOpacity(t[n].partsIndex);r=Object(l.b)(s+e/this.opacityAnimDuration,0,1)}else n=0,r=1;t.forEach(({partsIndex:t},e)=>{if(t>=0)if(n==e)i.setPartsOpacity(t,r);else{let e,n=i.getPartsOpacity(t);e=r<.5?-.5*r/.5+1:.5*(1-r)/.5,(1-e)*(1-r)>.15&&(e=1-.15/(1-r)),n>e&&(n=e),i.setPartsOpacity(t,n)}})}copyOpacity(t){const e=this.coreModel;t.forEach(({partsIndex:t,link:i})=>{if(t>=0&&i){const r=e.getPartsOpacity(t);i.forEach(({partsIndex:t})=>{t>=0&&e.setPartsOpacity(t,r)})}})}update(t){this.partsGroups.forEach(e=>{this.normalizePartsOpacityGroup(e,t),this.copyOpacity(e)})}}i(5).a.registerRuntime({version:2,test:t=>t instanceof v||v.isValidJSON(t),ready:()=>Promise.resolve(),isValidMoc(t){if(t.byteLength<3)return!1;const e=new Int8Array(t,0,3);return"moc"===String.fromCharCode(...e)},createModelSettings:t=>new v(t),createCoreModel(t){const e=Live2DModelWebGL.loadModel(t),i=Live2D.getError();if(i)throw i;return e},createInternalModel:(t,e,i)=>new p(t,e,i),createPose:(t,e)=>new b(t,e),createPhysics:(t,e)=>new y(t,e)})},,function(t,e,i){"use strict";if(!window.Live2D)throw new Error("Cannot find Cubism 2 runtime. Did you forget to include the live2d.min.js?")},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e);var r=i(32);i.d(e,"LOGICAL_WIDTH",(function(){return r.h})),i.d(e,"LOGICAL_HEIGHT",(function(){return r.g})),i.d(e,"ExpressionManager",(function(){return r.a})),i.d(e,"FocusController",(function(){return r.c})),i.d(e,"ModelSettings",(function(){return r.m})),i.d(e,"MotionPriority",(function(){return r.p})),i.d(e,"MotionState",(function(){return r.q})),i.d(e,"MotionPreloadStrategy",(function(){return r.o})),i.d(e,"MotionManager",(function(){return r.n})),i.d(e,"SoundManager",(function(){return r.r})),i.d(e,"InternalModel",(function(){return r.f})),i.d(e,"Live2DModel",(function(){return r.k})),i.d(e,"Live2DTransform",(function(){return r.l})),i.d(e,"InteractionMixin",(function(){return r.e})),i.d(e,"config",(function(){return r.x})),i.d(e,"VERSION",(function(){return r.s})),i.d(e,"Live2DFactory",(function(){return r.i})),i.d(e,"Live2DLoader",(function(){return r.j})),i.d(e,"XHRLoader",(function(){return r.t})),i.d(e,"FileLoader",(function(){return r.b})),i.d(e,"ZipLoader",(function(){return r.u})),i.d(e,"logger",(function(){return r.B})),i.d(e,"clamp",(function(){return r.w})),i.d(e,"rand",(function(){return r.C})),i.d(e,"copyProperty",(function(){return r.z})),i.d(e,"copyArray",(function(){return r.y})),i.d(e,"applyMixins",(function(){return r.v})),i.d(e,"folderName",(function(){return r.A})),i.d(e,"HitAreaFrames",(function(){return r.d}));var n=i(85);i.d(e,"Cubism2ExpressionManager",(function(){return n.a})),i.d(e,"Cubism2InternalModel",(function(){return n.b})),i.d(e,"Cubism2ModelSettings",(function(){return n.c})),i.d(e,"Cubism2MotionManager",(function(){return n.d})),i.d(e,"Live2DExpression",(function(){return n.e})),i.d(e,"Live2DEyeBlink",(function(){return n.f})),i.d(e,"Live2DPhysics",(function(){return n.g})),i.d(e,"Live2DPose",(function(){return n.h}))}])}));
//# sourceMappingURL=cubism2.min.js.map