const serverURL="http://localhost:50021",debug=!1,modelPath="/Resources/AModel/AModel/amodel.model3.json",position={boxWidth:500,boxHeight:700,modelScale:.13,modelX:0,modelY:300};let indexLibrary=null,next_flag=4;const agentFlag=document.getElementById("agent_visible_flag"),loader=document.querySelector(".loader"),overlayContents=document.getElementById("overlay_contents"),startButton=document.getElementById("start_button"),overlay=document.getElementById("overlay"),overlayWindow=document.getElementById("overlayWindow");function updateTopbar(e,t){const n=document.getElementById("topbar-right");n&&(n.textContent=`当前${e}　残り${t}個`)}agentFlag&&new MutationObserver((function(e){e.forEach((function(e){"1"===e.target.textContent&&(loader&&(loader.style.display="none"),overlayContents&&(overlayContents.style.visibility="visible"))}))})).observe(agentFlag,{characterData:!0,childList:!0,subtree:!0}),startButton?.addEventListener("click",(function(){next_flag-=1,overlay&&(overlay.style.display="none"),overlayWindow&&(overlayWindow.style.display="none"),indexLibrary.chatgpt_init("原子力発電所の再稼働によって、事故発生時に壊滅的な影響を及ぼすリスクが高まる"),updateTopbar("ABCABCABC",next_flag)})),window.addEventListener("load",(()=>{console.log("ロード"),indexLibrary=new IndexLibrary(!1,serverURL,modelPath,position),indexLibrary.onload(),console.log("main.js")}),!1),window.addEventListener("beforeunload",(()=>{console.log("アンロード"),indexLibrary.onUnload()}));const img=document.querySelector(".chat-input img"),sysTime=document.querySelector(".topbar-left"),currentTime=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});sysTime.innerHTML=currentTime;const btn=document.querySelector("#btn"),txt=document.querySelector("#txt");let next_b_flag,handleChat_flag,re_flag=1;next_b_flag=re_flag,btn?.addEventListener("click",(()=>{if(handleChat_flag=indexLibrary.checkReplyStatus(),!txt.value.trim()||0===handleChat_flag)return txt.style.border="2px solid red",void setTimeout((()=>{txt.style.border=""}),300);indexLibrary.updateNextButtonVisibility(0),indexLibrary.handleChat(5,"旅行"),console.log("next_b_flag",next_b_flag),console.log("next_flag",next_flag),console.log("handleChat_flag",handleChat_flag),next_flag>-1&&0===next_b_flag?(console.log("显示了",next_b_flag,next_flag,handleChat_flag),indexLibrary.updateNextButtonVisibility(1)):(next_b_flag-=1,indexLibrary.updateNextButtonVisibility(0))}));let lastMessageIndex=-1;var proposition=["123123","123123123","5646","789789"];function copyConversationToClipboard(e){const t=Array.prototype.slice.call(document.querySelectorAll(".chat-user, .chat-gpt-msg"));let n="",o="";o+="当前主题: "+proposition[e]+"\n\n";const l=t.filter(((e,t)=>-1===lastMessageIndex||t>lastMessageIndex));t.forEach((e=>{const t=e.querySelector(".time").innerHTML;if(e.querySelector(".copy-msg-USER")){const o=e.querySelector(".copy-msg-USER").innerHTML;n+="user: "+o+" ["+t+"]\n"}else if(e.querySelector(".copy-msg-GPT")){const o=e.querySelector(".copy-msg-GPT").innerHTML;n+="assistant: "+o+" ["+t+"]\n"}}));const r=document.getElementById("topbar-left");if(r&&(n+="\n"+r.innerHTML),l.length>0){l.forEach((e=>{const t=e.querySelector(".time").innerHTML;if(e.querySelector(".copy-msg-USER")){const n=e.querySelector(".copy-msg-USER").innerHTML;o+="user: "+n+" ["+t+"]\n"}else if(e.querySelector(".copy-msg-GPT")){const n=e.querySelector(".copy-msg-GPT").innerHTML;o+="assistant: "+n+" ["+t+"]\n"}}));const e=convertTimeToSeconds(l[0].querySelector(".time").innerHTML),n=convertTimeToSeconds(l[l.length-1].querySelector(".time").innerHTML)-e,r=Math.floor(n/60);o+=`\n対話時間: ${r}分${n%60}秒\n`,lastMessageIndex=t.length-1}var a="RoundChat_"+e;console.log("All conversations:",n),console.log("Current round:",o),console.log("RoundChat:",a)}function convertTimeToSeconds(e){const[t,n,o]=e.split(":").map(Number);return 3600*t+60*n+o}const copy=document.getElementById("git_copy");copy.addEventListener("click",(e=>{copyConversationToClipboard(next_flag)}));const next=document.getElementById("next1");next.style.visibility="hidden",next.style.pointerEvents="none",next.addEventListener("click",(e=>{next_b_flag=re_flag,next.style.visibility="hidden",next.style.pointerEvents="none",next_flag-=1,next_flag>0?(indexLibrary.chatgpt_init("事故発生時に壊滅的な影響を及ぼすリスクが高まる"),console.log("12312312312",next_flag),updateTopbar("CDECDECDE",next_flag)):updateTopbar("当前对话结束后，前往下一页",next_flag)}));let startTime=(new Date).getTime();function timingTime(){let e=(new Date).getTime()-startTime,t=Math.floor(e/1e3),n=t%60,o=Math.floor(t/60),l=o%60;return"経過時間："+Math.floor(o/60)%24+":"+l+":"+n}setInterval((()=>{document.getElementById("topbar-left").innerHTML=timingTime()}),1e3);